data,data_moves,path,max_x,max_y,count={(x[0],y):line.strip()[x[0]] for x in enumerate(open("data.txt","r").read().splitlines()[0].strip()) for y, line in enumerate(open("data.txt","r").read().splitlines())},{(x[0],y):{".": [],"|": [(x[0], y - 1), (x[0], y + 1)],"-": [(x[0] - 1, y), (x[0] + 1, y)],"L": [(x[0], y - 1), (x[0] + 1, y)],"J": [(x[0] - 1, y), (x[0], y - 1)],"7": [(x[0] - 1, y), (x[0], y + 1)],"F": [(x[0] + 1, y), (x[0], y + 1)],"S": [(x[0] - 1, y), (x[0] + 1, y), (x[0], y - 1), (x[0], y + 1)]}[line.strip()[x[0]]] for x in enumerate(open("data.txt","r").read().splitlines()[0].strip()) for y, line in enumerate(open("data.txt","r").read().splitlines())},[[(x[0],y[0]) for x in enumerate(y[1]) if x[1]=="S"] for y in enumerate(open("data.txt","r").read().splitlines()) if "S" in y[1]][0],max(x[0] for x in {(x[0],y):line.strip()[x[0]] for x in enumerate(open("data.txt","r").read().splitlines()[0].strip()) for y, line in enumerate(open("data.txt","r").read().splitlines())}),max(y[1] for y in {(x[0],y):line.strip()[x[0]] for x in enumerate(open("data.txt","r").read().splitlines()[0].strip()) for y, line in enumerate(open("data.txt","r").read().splitlines())}),0
while path[-1] != path[0] or len(path) < 2: path.append([i for i in data_moves[path[-1]] if (path[-1] in data_moves[i]) and ((i not in path) or (i == path[0] and len(path) > 2))][0])
for y in range(max_y+1):
    counter,tunnel = False,None
    for x,i in [(x, data[x,y]) for x in range(max_x+1)]: counter,tunnel,count=(not counter if (x,y) in path and (i in ["|","S"] or ((tunnel=="F" and i=="J") or (tunnel=="L" and i=="7"))) else counter),(i if (x,y) in path and i in ["F", "L"] else tunnel),(count+counter if not (x,y) in path else count)
print(count)